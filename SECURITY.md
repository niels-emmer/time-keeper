# Security

> This document is aimed at anyone considering self-hosting this project. It gives an honest overview of the security posture, known risks, and mitigations so you can make an informed decision.

---

## Who wrote this code?

All application code was generated by [Claude Code](https://claude.ai/claude-code) (Anthropic). The author directed the design and reviewed the output, but the code has **not been independently audited or pentested**. Treat it accordingly.

---

## Threat model

This is a single-user (or small-team) personal productivity tool, not a public-facing service. The realistic threats are:

| Threat | Likelihood | Mitigation |
|--------|-----------|------------|
| Unauthorised access to your time data | Low | Authentik auth blocks the app entirely before any request reaches it |
| SQL injection | Low | All queries use Drizzle ORM with parameterised statements; no raw SQL with user input |
| XSS | Low | React escapes output by default; no `dangerouslySetInnerHTML` is used |
| Supply chain attack on a dependency | Very low | Standard npm ecosystem risk; see dependency audit below |
| Server-side request forgery | N/A | The backend makes no outbound HTTP requests |
| Data exfiltration via the API | Low | All API routes require the `X-authentik-email` header set by the proxy; there is no unauthenticated write surface |
| Secrets in the repo | None | No API keys, tokens, or credentials are stored in the codebase |

---

## Authentication

Auth is **not implemented in this application**. It is entirely delegated to [Authentik](https://goauthentik.io) via Nginx Proxy Manager's forward-auth integration:

```
Internet → NPM (TLS termination + forward auth) → Authentik outpost → app
```

The backend only reads the `X-authentik-email` header that the outpost sets on authenticated requests. If that header is absent in production, the backend returns 401 and nothing else runs.

**Implication:** the security of this app is only as good as your Authentik + NPM setup. If you misconfigure forward auth so that requests can reach the app without passing through Authentik, there is no second line of defence in the application layer.

See [docs/integration/auth.md](docs/integration/auth.md) for the exact configuration.

---

## Data storage

- All data lives in a **single SQLite file** on the host (`/data/time-keeper.db` inside the backend container, mounted as a Docker volume).
- There is no external database, no cloud sync, no analytics, no telemetry.
- The file is readable by anyone with shell access to the host. Protect it with standard filesystem permissions and volume encryption if required.
- Backup = copy the file. See [docs/integration/docker.md](docs/integration/docker.md) for the one-liner.

---

## Dependency audit

Audited with `yarn npm audit` on **2026-02-20**: **no vulnerabilities found**.

Runtime dependencies and their risk profiles:

| Package | Version pinned to | Notes |
|---------|------------------|-------|
| `express` | `^4` | 15+ years old, very widely used, actively maintained |
| `better-sqlite3` | `^11` | Widely used SQLite binding; includes a native C++ addon compiled at install time — highest-risk category by nature of native code |
| `drizzle-orm` | `^0.38` | Newer library (2022–); less battle-tested than Prisma but growing adoption |
| `zod` | `^3` | Pure TypeScript; used for all input validation on the backend |
| `express-rate-limit` | `^7` | Simple, auditable rate-limiting middleware |
| `react` + `vite` | current | Mainstream, heavily used |
| `@tanstack/react-query` | current | Mainstream, well-maintained |
| `@radix-ui/*` / `shadcn/ui` | current | Accessible, widely used UI primitives |
| `@dnd-kit/*` | current | Pure JS drag-and-drop; no native code |

**To re-run the audit yourself:**
```bash
yarn npm audit
```

**The native addon caveat:** `better-sqlite3` compiles C++ at `yarn install` time using `node-gyp`. This is normal and the package is widely used, but it means you are trusting both the npm registry and your local C++ toolchain. If this concerns you, inspect `node_modules/better-sqlite3/build/` after install.

---

## What has not been done

To be explicit about what a proper security review would include and this project has not had:

- No penetration test
- No static analysis (SAST) beyond TypeScript's type checker
- No dependency licence audit
- No review of the nginx configuration for header injection or bypass
- No assessment of the Authentik configuration for misconfigurations
- No fuzzing of API inputs beyond Zod schema validation

---

## Reporting issues

This is a personal project with no formal security team. If you find a vulnerability:

1. Open a [GitHub issue](https://github.com/niels-emmer/time-keeper/issues) and label it `security`
2. Or contact the repository owner directly via GitHub

There is no SLA or bug bounty.
